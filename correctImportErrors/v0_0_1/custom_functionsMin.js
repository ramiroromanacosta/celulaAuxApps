async function splitHeadersAndLines(e){function a(e){return(e=e.includes('"')?e.replaceAll('"',""):e).includes(",")&&(e=e.replaceAll(",","")),parseInt(e)}function r(e){return 0==(e=(e=e.includes('"')?e.replaceAll('"',""):e).includes(",")?e.replaceAll(",",""):e).includes(".")&&(e+=".00"),parseFloat(e).toFixed(2)}var n,o;invoicesHeadersRows=new Array,invoicesLinesRows=new Array,textLines=e.split("\r\n");for(var c,t=0;t<textLines.length;t++)(textLine=textLines[t]).includes("Cabeceras de factura")&&(n="headers"),textLine.includes("LÃ­neas de factura")&&(n="lines"),tmpVector=textLine.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/),"headers"==n&&1==!!(""==(c=tmpVector)[0]&""==c[1]&""==c[2]&""==c[3]&""==c[4]&""!=c[5])&&((o=tmpVector.slice(5,149))[0]=a(o[0]),o[9]=r(o[9]),o[36]=r(o[36]),invoicesHeadersRows.push(o)),"lines"==n&&1==!!(""==(c=tmpVector)[0]&""==c[1]&""==c[2]&""==c[3]&""==c[4]&""!=c[5])&&((o=tmpVector.slice(5,151))[0]=a(o[0]),o[6]=r(o[6]),o[7]=a(o[7]),o[8]=r(o[8]),invoicesLinesRows.push(o));return invoicesHeadersDf=(invoicesHeadersDf=(invoicesHeadersDf=(invoicesHeadersDf=new dfd.DataFrame(invoicesHeadersRows,{columns:invoiceHeadersColumns})).asType("Identificador_de_cabecera_de_factura","int32")).asType("Importe_de_factura","float32")).asType("Tipo_de_cambio","float32"),InvoicesLinesDf=(InvoicesLinesDf=(InvoicesLinesDf=(InvoicesLinesDf=(InvoicesLinesDf=new dfd.DataFrame(invoicesLinesRows,{columns:invoiceLinesColumns})).asType("Identificador_de_cabecera_de_factura","int32")).asType("Importe","float32")).asType("Cantidad_facturada","float32")).asType("Precio_unitario","float32"),{headers:invoicesHeadersDf,lines:InvoicesLinesDf}}async function getDuplicatesSet(){var a,e=new Array,r=invoicesHeadersDf.groupby(["Numero_de_factura"]).col(["Numero_de_factura"]).count(),n=r.$columns,r=(r.$data.forEach(function(a){var r={};for(let e=0;e<n.length;e++)r[n[e]]=a[e];e.push(r)}),e.filter(e=>1<e.Numero_de_factura_count));r&&0<r.length&&(a=new Array,r.forEach(function(e){a.push(e.Numero_de_factura)}),r=new dfd.DataFrame({Numero_de_factura:a}),r=(dupInvoicesHeadersDf=dfd.merge({left:r,right:invoicesHeadersDf,on:["Numero_de_factura"],how:"left"})).loc({columns:["Identificador_de_cabecera_de_factura"]}),dupInvoicesLinesDf=dfd.merge({left:r,right:InvoicesLinesDf,on:["Identificador_de_cabecera_de_factura"],how:"inner"}),existInvoicesDuplicates=!0)}async function getUniqueInvoices(){new Array;var e=invoicesHeadersDf.loc({columns:["Numero_de_factura","Identificador_de_cabecera_de_factura"]}).groupby(["Numero_de_factura"]).col(["Identificador_de_cabecera_de_factura"]).min(),a=(e.rename({Identificador_de_cabecera_de_factura_min:"Identificador_de_cabecera_de_factura"}),e.$data),r=new Array,n=new Array;for(m=0;m<a.length;m++)r.push(a[m][0]),n.push(a[m][1]);var e=new dfd.DataFrame({Numero_de_factura:r,Identificador_de_cabecera_de_factura:n}),o=e.loc({columns:["Identificador_de_cabecera_de_factura"]});noDupsInvoicesHeadersDf=dfd.merge({left:e,right:invoicesHeadersDf,on:["Numero_de_factura","Identificador_de_cabecera_de_factura"],how:"left"}),noDupsInvoicesLinesDf=dfd.merge({left:o,right:InvoicesLinesDf,on:["Identificador_de_cabecera_de_factura"],how:"inner"})}async function getReducedDataSets(){InvoicesHeadersMinDf=noDupsInvoicesHeadersDf.loc({columns:invoiceHeadersMinColumns}),InvoicesLinesMinDf=noDupsInvoicesLinesDf.loc({columns:invoiceLinesMinColumns});let e=InvoicesHeadersMinDf.groupby(["Unidad_de_negocio","Origen","Moneda_de_factura"]),a=e.col(["Importe_de_factura"]).count(),r=e.col(["Importe_de_factura"]).sum(),n=(a.rename({Importe_de_factura_count:"Numero_de_facturas"},{inplace:!0}),r.rename({Importe_de_factura_sum:"Importe_de_facturas"},{inplace:!0}),dfd.merge({left:a,right:r,on:["Unidad_de_negocio","Origen","Moneda_de_factura"],how:"left"})),o=(n=n.fillNa(0),drawAdHocTable(n,"tab1PaneContent"),InvoicesHeadersMinDf.groupby(["Unidad_de_negocio","Origen","Proveedor","Moneda_de_factura"])),c=o.col(["Importe_de_factura"]).count(),t=o.col(["Importe_de_factura"]).sum(),i=(c.rename({Importe_de_factura_count:"Numero_de_facturas"},{inplace:!0}),t.rename({Importe_de_factura_sum:"Importe_de_facturas"},{inplace:!0}),dfd.merge({left:c,right:t,on:["Unidad_de_negocio","Origen","Proveedor","Moneda_de_factura"],how:"left"})),d=(i=i.fillNa(0),drawAdHocTable(i,"tab2PaneContent"),InvoicesHeadersMinDf.groupby(["Errores_de_importacion","Unidad_de_negocio","Origen","Moneda_de_factura"])),s=d.col(["Importe_de_factura"]).count(),_=d.col(["Importe_de_factura"]).sum(),f=(s.rename({Importe_de_factura_count:"Numero_de_facturas"},{inplace:!0}),_.rename({Importe_de_factura_sum:"Importe_de_facturas"},{inplace:!0}),dfd.merge({left:s,right:_,on:["Errores_de_importacion","Unidad_de_negocio","Origen","Moneda_de_factura"],how:"left"})),u=(f=f.fillNa(0),drawAdHocTable(f,"tab3PaneContent"),InvoicesHeadersMinDf.groupby(["Errores_de_importacion","Unidad_de_negocio","Origen","Proveedor","Moneda_de_factura"])),l=u.col(["Importe_de_factura"]).count(),m=u.col(["Importe_de_factura"]).sum(),p=(l.rename({Importe_de_factura_count:"Numero_de_facturas"},{inplace:!0}),m.rename({Importe_de_factura_sum:"Importe_de_facturas"},{inplace:!0}),dfd.merge({left:l,right:m,on:["Errores_de_importacion","Unidad_de_negocio","Origen","Proveedor","Moneda_de_factura"],how:"left"}));p=p.fillNa(0),drawAdHocTable(p,"tab4PaneContent"),dataSetInvoiceHeaders=new Array;var v=InvoicesHeadersMinDf.$columns,v=(InvoicesHeadersMinDf.$data.forEach(function(a){var r={};for(let e=0;e<v.length;e++)r[v[e]]=a[e];dataSetInvoiceHeaders.push(r)}),dataSetInvoiceLines=new Array,InvoicesLinesMinDf.$columns);InvoicesLinesMinDf.$data.forEach(function(a){var r={};for(let e=0;e<v.length;e++)r[v[e]]=a[e];dataSetInvoiceLines.push(r)}),suppliersList=new Array,p.sortValues("Importe_de_facturas",{ascending:!1,inplace:!0});for(var I=0;I<p.index.length;I++){var g=p.at(I,"Importe_de_facturas").toFixed(2).toString(),g=""!=p.at(I,"Proveedor")?p.at(I,"Proveedor")+" - "+formatAsCurrency(g):"Unknown - "+formatAsCurrency(g),D=p.at(I,"Proveedor");suppliersList.push({text:g,value:D})}1<suppliersList.length&&(addOptionstoSuppliersMenu(),getSupplierInvoices(p.at(0,"Proveedor")))}