var selectedFile,dataAsArray,df,subSetDf,suppliersList,tabsNavsAndAppContentContainer=document.getElementById("tabsNavsAndAppContent"),appInProgressContainer=document.getElementById("appInProgress"),fileInScope=document.getElementById("fileInScope"),readFileButton=document.getElementById("readFilebutton"),supplierSelector=document.getElementById("supplierSelector"),searchInvoicesButton=document.getElementById("searchInvoicesButton"),supplierSpecificTable=document.getElementById("supplierSpecificTable"),supplierQueryInProgress=document.getElementById("supplierQueryInProgress"),dataSet=new Array,ColumnsInScope=["SUPPLIER","BUSINESS_UNIT","SOURCE","START_DATE","END_DATE","SOURCE2","INVOICE_NUM","ORG_NAME","INVOICE_ID","INVOICE_DATE","SUPPLIER2","PAYMENT_STATUS","INVOICE_AMOUNT","AMOUNT_PAID","CURRENCY","RATE","PAYMENT_NUM","PAYMENT_TYPE","SUPPLIER_ID","UUID","ACCOUNT","RFC","PAY_FLAG","SITE","UPDATE_DATE"];async function drawAdHocTable(t,e){var o=new google.visualization.DataTable,r=new Array,a=new Array;for(let e=0;e<t.ctypes.$index.length;e++){var n=t.ctypes.$index[e].toString(),i=t.ctypes.$data[e].toString(),i="boolean"==i?"boolean":"float32"==i?"number":"int32"==i?"number":"string";r.push(n),a.push(i),o.addColumn(i,n)}new Array,t.values.forEach(function(t){let r=new Array;for(let e=0;e<t.length;e++)"string"==a[e]&&((tmpStr=t[e].toString()).includes('"')?r.push(tmpStr.replace('"',"").replace('"',"")):r.push(tmpStr)),"number"==a[e]&&((tmpStr=t[e].toString()).includes(".")?r.push({v:parseFloat(tmpStr),f:((n=(n=tmpStr).split("."))[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),"$ "+n.join("."))}):r.push({v:parseFloat(tmpStr),f:tmpStr})),"boolean"==a[e]&&r.push(t[e]);var n;o.addRows([r])});new google.visualization.Table(document.getElementById(e)).draw(o,{showRowNumber:!0,width:"100%",height:"100%"})}async function addOptionstoSuppliersMenu(e){var n=document.getElementById("supplierSelector");for(let r=0;r<suppliersList.length;r++){let e=suppliersList[r].toString(),t=document.createElement("option");t.value=e,t.innerHTML=e.replace('"',"").replace('"',""),n.appendChild(t)}}async function filterDataframeBySupplier(t){supplierSpecificTable.classList.replace("d-block","d-none"),supplierQueryInProgress.classList.replace("d-none","d-block");var e,r=new Array,n=new Array,o=dataSet.filter(e=>e.SUPPLIER2==t);for(e in o[0])r.push(e);for(let e=0;e<o.length;e++){var a=o[e],i=new Array;for(let e=0;e<r.length;e++)i.push(a[r[e]]);n.push(i)}for(let e=0;e<n.length;e++)n[e][0]=n[e][0].toString(),n[e][8]=n[e][8].toString(),n[e][12]=parseFloat(n[e][12]).toFixed(2),n[e][13]=parseFloat(n[e][13]).toFixed(2),n[e][15]=n[e][15].toString(),n[e][16]=n[e][16].toString(),n[e][18]=n[e][18].toString(),n[e][20]=n[e][20].toString();drawAdHocTable(subSetDf=(subSetDf=(subSetDf=(subSetDf=(subSetDf=(subSetDf=(subSetDf=(subSetDf=(subSetDf=new dfd.DataFrame(n,{columns:r})).asType("SUPPLIER","string")).asType("INVOICE_ID","string")).asType("INVOICE_AMOUNT","float32")).asType("AMOUNT_PAID","float32")).asType("RATE","string")).asType("PAYMENT_NUM","string")).asType("SUPPLIER_ID","string")).asType("ACCOUNT","string"),"supplierSpecificTable"),supplierSpecificTable.classList.replace("d-none","d-block"),supplierQueryInProgress.classList.replace("d-block","d-none")}async function getDataFrame(){var n=(df=(df=(df=new dfd.DataFrame(dataAsArray,{columns:ColumnsInScope})).asType("INVOICE_AMOUNT","float32")).asType("AMOUNT_PAID","float32")).$columns;df.$data.forEach(function(t){var r={};for(let e=0;e<n.length;e++)r[n[e]]=t[e];dataSet.push(r)})}async function analyzeData(){var e,t,r;BUSourceGrouping=df.groupby(["BUSINESS_UNIT","SOURCE2","PAYMENT_STATUS","CURRENCY"]),BUSourceGroupingSum=BUSourceGrouping.col(["INVOICE_AMOUNT","AMOUNT_PAID"]).sum();for(var n=new Array,o=0;o<BUSourceGroupingSum.index.length;o++)e=BUSourceGroupingSum.at(o,"INVOICE_AMOUNT_sum"),t=BUSourceGroupingSum.at(o,"AMOUNT_PAID_sum"),pctKPI=100*t/e,r=!0,e.toFixed(2)!=t.toFixed(2)&&(r=!1),n.push([BUSourceGroupingSum.at(o,"BUSINESS_UNIT"),BUSourceGroupingSum.at(o,"SOURCE2"),BUSourceGroupingSum.at(o,"PAYMENT_STATUS"),BUSourceGroupingSum.at(o,"CURRENCY"),e.toFixed(2),t.toFixed(2),pctKPI.toFixed(2).toString()+"%",r]);drawAdHocTable(BUSourcegroupingSumDf=new dfd.DataFrame(n,{columns:["BUSINESS_UNIT","SOURCE","PAYMENT_STATUS","CURRENCY","CUM_INVOICE_AMOUNT","CUM_AMOUNT_PAID","PCT_KPI","STATUS"]}),"tab1PaneContent"),BUSourceSupplierGrouping=df.groupby(["BUSINESS_UNIT","SOURCE2","SUPPLIER2","PAYMENT_STATUS","CURRENCY"]),BUSourceSupplierGroupingSum=BUSourceSupplierGrouping.col(["INVOICE_AMOUNT","AMOUNT_PAID"]).sum(),n=new Array,suppliersList=new Array;for(o=0;o<BUSourceSupplierGroupingSum.index.length;o++)e=BUSourceSupplierGroupingSum.at(o,"INVOICE_AMOUNT_sum"),t=BUSourceSupplierGroupingSum.at(o,"AMOUNT_PAID_sum"),pctKPI=100*t/e,r=!0,e.toFixed(2)!=t.toFixed(2)&&(r=!1,suppliersList.push(BUSourceSupplierGroupingSum.at(o,"SUPPLIER2"))),n.push([BUSourceSupplierGroupingSum.at(o,"BUSINESS_UNIT"),BUSourceSupplierGroupingSum.at(o,"SOURCE2"),BUSourceSupplierGroupingSum.at(o,"SUPPLIER2"),BUSourceSupplierGroupingSum.at(o,"PAYMENT_STATUS"),BUSourceSupplierGroupingSum.at(o,"CURRENCY"),e.toFixed(2),t.toFixed(2),pctKPI.toFixed(2).toString()+"%",r]);BUSourceSupplierGroupingSumDf=new dfd.DataFrame(n,{columns:["BUSINESS_UNIT","SOURCE","SUPPLIER","PAYMENT_STATUS","CURRENCY","CUM_INVOICE_AMOUNT","CUM_AMOUNT_PAID","PCT_KPI","STATUS"]}),addOptionstoSuppliersMenu(suppliersList=suppliersList.sort()),filterDataframeBySupplier(suppliersList[0]),drawAdHocTable(BUSourceSupplierGroupingSumDf,"tab2PaneContent"),appInProgressContainer.classList.replace("d-block","d-none"),tabsNavsAndAppContentContainer.classList.replace("d-none","d-block"),searchInvoicesButton.disabled=!1,readFileButton.disabled=!0}async function getArraysFromContent(e){dataAsArray=new Array,textLines=e.split("\n");for(var t=1;t<textLines.length;t++)textLine=textLines[t],25==(tmpVector=textLine.split(",")).length&&dataAsArray.push(tmpVector)}function searchSupplierInvoices(){filterDataframeBySupplier(supplierSelector.value)}function readFileInScope(){appInProgressContainer.classList.replace("d-none","d-block");const e=new FileReader;e.onload=e=>{getArraysFromContent(e.target.result),getDataFrame(),analyzeData()},e.onerror=e=>{e=e.target.error;console.error(e)},e.readAsText(selectedFile)}function addEventListeners(){fileInScope.addEventListener("change",e=>{selectedFile=e.target.files[0],readFilebutton.disabled=!1}),readFilebutton.addEventListener("click",e=>{tabsNavsAndAppContent.classList.replace("d-block","d-none"),appInProgress.classList.replace("d-none","d-block"),readFileInScope()})}required_libraries=["https://cdn.jsdelivr.net/npm/danfojs@1.0.2/lib/bundle.min.js"];const loadScript=function(n){return new Promise(function(e,t){const r=document.createElement("script");r.src=n,r.addEventListener("load",function(){e(!0)}),document.head.appendChild(r)})},waterfall=function(e){return e.reduce(function(e,t){return e.then(function(){return t.then(function(e){return!0})})},Promise.resolve([]))},loadScriptsInOrder=function(e){e=e.map(function(e){return loadScript(e)});return waterfall(e)};tabsNavsAndAppContentContainer.classList.replace("d-block","d-none"),appInProgressContainer.classList.replace("d-block","d-none"),fileInScope.value="",readFilebutton.disabled=!0,searchInvoicesButton.disabled=!0,loadScriptsInOrder(required_libraries).then(function(){fileInScope.value="",readFilebutton.disabled=!0,addEventListeners()});
